# Fruit Machine Builder — Progress & Resume Guide

**Last updated:** 2026-02-20

---

## Project Summary

Building a **highly customizable fruit machine builder** — a React app where users create, configure, and test their own fruit machine simulators.

**Stack:** Vite + React 19 + TypeScript + React Context + @dnd-kit + PixiJS v8 + Web Audio API + Web Workers

**Design:** Fully flexible (any grid size, any payline pattern, any combo type), hardware-accelerated animations, and non-blocking performance calculation threads.

---

## What's Done ✅

### Config & Build Files

- `package.json` — all deps declared (React 19, @dnd-kit, PixiJS, Vitest)
- `vite.config.ts` — uses `app.html` as entry (preserves original `index.html`)
- Assets relocated directly to `public/` directory for robust bundling.

### Core Engine

- `src/utils/spinEngine.ts` — pure crypto-RNG stop selection, grid builder, payline evaluator. Secured by Vitest.
- React Context (`configStore.ts`) — robust, persistent global state replacing previous Zustand setup.
- `src/types/machine.ts` — comprehensive type definitions.

### Editors & Layout

- Global Dark Theme design system.
- Sidebar Nav with 8 specialized tool modules.
- **ConfigEditor, SymbolManager, ReelStripDesigner, PaytableEditor, PaylineEditor**.
- **AnimationConfig**: Adjust bounce, blur, and speed of PixiJS spins.
- **AudioConfig**: Map synth tones (`mechanical`, `click`, etc.) or custom audio files to spins and wins. Global BGM controls.
- **PresetManager**: Automatically saves, tracks, and loads configs locally via `localStorage`.

### Simulator & Processing

- **PixiReels** (`PixiReels.tsx`): Hardware-accelerated canvas for slot rendering. Replaces standard DOM element for smooth looping and bouncy stops.
- **StatsDashboard** (`StatsDashboard.tsx`): Generates 10M+ background spins using a Web Worker (`rtpWorker.ts`) to calculate mathematically accurate RTP/Hit Frequency without locking up the browser.

---

## What's Pending ⏳ (Phase 3: Finalization)

### Immediate Next Steps

1. **Refine `build_zip.py`**: Currently slices Python sprite sheets and moves images. Needs to be refactored or extended to automatically package the `dist/` directory generated by `npm run build` into a deploy-ready `.zip` standalone application.
2. Verify all `public/` assets cleanly map within Vite's build chunk.
3. Write finalize instructions for User deployment of the exported ZIP.

### Future Development Path Road Ahead

- **AI Art Integrations**: Architecture hooks are established to generate symbol sheet art dynamically via DALL-E / Gemini APIs.
- **Advanced Audio Library**: Tie in hooks to generate royalty-free background loops using AI music services.
- **Global Database**: Move preset management from `localStorage` to a hosted Database solution (Supabase / Firebase) for user sharing.
- **Game Export**: Export an un-editable "Player Only" standalone URL that locks away the build tools and just serves the game.

---

## Resume Commands

```bash
cd x:\Projects\Web\React\game-random-runner
npm run dev
```

Then open `http://localhost:5173/app.html` in browser.

---

## File Map

```text
x:\Projects\Web\React\game-random-runner\
├── app.html                         # Vite entry
├── index.html                       # Original prototype (KEPT)
├── Toolkit.html                     # Standalone reel mapper tool (KEPT)
├── package.json                     
├── vite.config.ts                   
├── tsconfig.json                    
├── tsconfig.app.json                
├── tsconfig.node.json               
├── deep-research-report.md          # Reference doc (KEPT)
├── build_zip.py                     # Automates build packaging (PENDING REFACTOR)
├── public/                          # Static assets and generated sprite slices
└── src/
    ├── main.tsx                     # React entry
    ├── App.tsx                      # App shell + routing (PresetManager)
    ├── index.css                    # Design system
    ├── utils/
    │   ├── spinEngine.ts            # Math logic
    │   └── audioEngine.ts           # Web Audio API Synth implementation
    ├── editors/
    │   ├── ConfigEditor... AudioConfig... StatsDashboard...
    └── simulator/
        ├── SimulatorView.tsx
        ├── PixiReels.tsx            # PixiJS Hardware Rendering
        └── rtpWorker.ts             # Web Worker Math thread
```
